---
import { getCommunities } from "../lib/communities";

const communities = await getCommunities();
---

<div class="communities-container">
  <div class="slider-container">
    <h2 class="slider-title">Topluluklar</h2>
    <div class="slider">
      {communities.map((community, index) => (
        <div class="slide" data-index={index}>
          <img src={community.image} alt={community.name} />
        </div>
      ))}
    </div>
    <div class="slider-controls">
      <button class="prev">&#9664;</button>
      <div class="slider-bar">
        <div class="slider-progress"></div>
      </div>
      <button class="next">&#9654;</button>
    </div>
  </div>
  <div class="content-container">
    {communities.map((community, index) => (
      <div class="content" data-index={index}>
        <h3 class="content-title">{community.name}</h3>
        <p class="content-description">{community.description}</p>
        <a href={community.link} class="join-button" target="_blank">Join Now!</a>
      </div>
    ))}
  </div>
</div>

<style>
  .communities-container {
    display: flex;
    gap: 2rem;
    padding: 2rem;
    background-color: #1a1a1a;
    border-radius: 8px;
    max-width: 1200px;
    margin: 0 auto;
  }
  .slider-container {
    width: 60%;
  }
  .slider-title {
    color: white;
    margin-bottom: 1rem;
  }
  .slider {
    display: flex;
    overflow: hidden;
    gap: 1rem;
  }
  .slide {
    flex: 0 0 150px;
    height: 150px;
    border: 2px solid transparent;
    cursor: pointer;
    transition: border-color 0.3s;
  }
  .slide.active {
    border-color: #ff4500;
  }
  .slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .slider-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 1rem;
  }
  .slider-bar {
    flex-grow: 1;
    height: 5px;
    background-color: #333;
  }
  .slider-progress {
    height: 100%;
    background-color: #ff4500;
    width: 0;
  }
  .prev, .next {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
  }
  .content-container {
    width: 40%;
  }
  .content {
    display: none;
    color: white;
  }
  .content.active {
    display: block;
  }
  .content-title {
    margin-bottom: 1rem;
  }
  .join-button {
    display: inline-block;
    padding: 0.5rem 1rem;
    background-color: #ff4500;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    margin-top: 1rem;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const slides = document.querySelectorAll(".slide");
    const contents = document.querySelectorAll(".content");
    const prevButton = document.querySelector(".prev");
    const nextButton = document.querySelector(".next");
    const progress = document.querySelector(".slider-progress");

    let currentIndex = 0;

    function updateContent() {
      slides.forEach((slide, index) => {
        slide.classList.toggle("active", index === currentIndex);
      });
      contents.forEach((content, index) => {
        content.classList.toggle("active", index === currentIndex);
      });
      const progressWidth = (currentIndex / (slides.length - 1)) * 100;
      progress.style.width = `${progressWidth}%`;
    }

    slides.forEach((slide) => {
      slide.addEventListener("click", () => {
        currentIndex = parseInt(slide.dataset.index);
        updateContent();
      });
    });

    prevButton.addEventListener("click", () => {
      currentIndex = (currentIndex - 1 + slides.length) % slides.length;
      updateContent();
    });

    nextButton.addEventListener("click", () => {
      currentIndex = (currentIndex + 1) % slides.length;
      updateContent();
    });

    updateContent();
  });
</script>
